<div id="chat-container">
    <div id="chat-header">Ask Web3ChainLabsAI</div>
    <div id="chat-messages"></div>
    <input id="chat-input" type="text" placeholder="Type here..." autocomplete="off">
    <button id="send-button">Send</button>
</div>

<style>
    #chat-container {
        width: 450px;
        height: 550px;
        background: #b3e5fc;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        overflow: hidden;
        margin: 0 auto;
    }
    #chat-header {
        background: #81d4fa;
        padding: 15px;
        text-align: center;
        font-weight: bold;
    }
    #chat-messages {
        height: 70%;
        overflow-y: auto;
        padding: 20px;
        background: #e1f5fe;
    }
    #chat-messages p {
        margin: 10px 0;
        padding: 12px;
        border-radius: 10px;
        max-width: 80%;
        background: #81d4fa;
    }
    #chat-input {
        width: 80%;
        padding: 15px;
        box-sizing: border-box;
        border: none;
        background: #81d4fa;
        font-size: 16px;
        outline: none;
        display: inline-block;
    }
    #send-button {
        width: 18%;
        padding: 15px;
        background: #0288d1;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        display: inline-block;
    }
</style>

<script>
    const RENDER_URL = "https://web3-aicrypto-bot-free.onrender.com";
    const messagesDiv = document.getElementById('chat-messages');
    const input = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-button');

    // Брояч на безплатни въпроси с localStorage
    let questionCount = parseInt(localStorage.getItem('questionCount')) || 0;
    const maxFreeQuestions = 5;

    input.focus();

    sendButton.addEventListener('click', async () => {
        if (input.value.trim()) {
            const userMessage = input.value;

            if (questionCount < maxFreeQuestions) {
                messagesDiv.innerHTML += `<p><strong>You:</strong> ${userMessage}</p>`;
                input.value = '';
                try {
                    const response = await fetch(`${RENDER_URL}/api/chat?message=${encodeURIComponent(userMessage)}`);
                    if (!response.ok) throw new Error('Server not responding');
                    const data = await response.json();
                    messagesDiv.innerHTML += `<p><strong>Bot:</strong> ${data.response}</p>`;
                    questionCount++;
                    localStorage.setItem('questionCount', questionCount);
                } catch (error) {
                    messagesDiv.innerHTML += `<p><strong>Bot:</strong> Error: ${error.message}</p>`;
                }
            } else {
                messagesDiv.innerHTML += `<p><strong>Bot:</strong> You’ve reached the limit of ${maxFreeQuestions} free questions. Please subscribe for more!</p>`;
            }
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
    });
</script>
